try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="7c15812a-f14e-4b3b-b0ee-8e88252ddb3a",e._sentryDebugIdIdentifier="sentry-dbid-7c15812a-f14e-4b3b-b0ee-8e88252ddb3a")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[265],{69969:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/gallery/upload-asset",function(){return a(73548)}])},73548:(e,t,a)=>{"use strict";a.r(t),a.d(t,{__N_SSG:()=>U,default:()=>D});var i=a(37876),s=a(14232),r=a(8981),n=a(99735);a(52100);var l=a(40359),o=a(73056),c=a(64221),d=a(89126),u=a(27321),_=a(62572);let f=()=>{let e=(0,c.t)();return(0,s.useCallback)(()=>{e([{title:"W TOKU",action:()=>void 0,icon:_.H.Loading}])},[e])};var p=a(47379),h=a(15102),b=a(48566),g=a(40503),v=a(45524),C=a(87662);let w=e=>"__id__".concat(e);var y=a(69542),R=a(30027),j=a(77046),k=a(89099),E=a(92089),O=a(33461),m=a(82777),x=a(71839),A=a(14259),P=a(125);let z=e=>{let{isViewOpen:t,handleCloseView:a,...s}=e;return(0,i.jsxs)(O.A,{open:t,onClose:a,slotProps:{paper:{sx:{justifyContent:"space-between"}}},children:[(0,i.jsxs)(l.A,{sx:{width:"100%"},children:[(0,i.jsx)(m.A,{variant:"caption",marginBottom:o.M.spacing[3],children:"Edytuj cechy zdjęcia"}),(0,i.jsx)(P.O,{...s})]}),(0,i.jsx)(x.A,{sx:{justifyContent:"flex-end"},children:(0,i.jsxs)(A.A,{color:"info",onClick:a,size:"large",children:["OK ",_.H.Accept({color:"inherit",fontSize:"large",sx:{marginLeft:o.M.spacing[2]}})]})})]})};var L=a(23317),N=a(45135);let S=e=>{let{imageSize:t,visibleArea:a}=e;return{width:(null==a?void 0:a.width)||t.width,height:(null==a?void 0:a.height)||t.height}},T=()=>{let e=(0,v.GV)(C.mi),t=(0,k.useRouter)(),[a,O]=(0,s.useState)(null),[m,x]=(0,s.useState)(),[A,P]=(0,s.useState)("edit"),[T,U]=(0,s.useState)(!1),[D,I]=(0,s.useState)(!1),[M,G]=(0,s.useState)(L.l),H=(0,s.useMemo)(()=>M.asset_traits.length>0&&M.asset_color_traits.length>0,[M.asset_color_traits.length,M.asset_traits.length]),Q=(0,s.useRef)(null),B=f(),F=(0,c.t)(),J=(0,s.useCallback)(()=>{F([])},[F]),K=(0,s.useCallback)(()=>{U(!1),(0,h.UT)()},[]),V=(0,s.useCallback)(()=>{F([{title:"WR\xd3Ć",icon:_.H.Back,action:()=>{P("edit")}},{title:"DODAJ",icon:_.H.Accept,action:async()=>{let t;if(!(null==e?void 0:e.user_id))return void(0,d.O)("UploadAction no user.",[e,m]);if(!a)return void(0,d.O)("UploadAction no image.",[e,m]);(0,p.Q)("Przetwarzanie zdjęcia, jeszcze chwila...","info"),B();let i=new FormData;i.append("file",a,w(e.user_id)),i.append("asset_folder",(t=e.user_id,(0,R.b8)()+"_"+w(t))),i.append("upload_preset",y.p),i.append("resource_type","image"),await (0,g.dm)(i,async e=>{await (0,g.RQ)({asset_url:e.secure_url,...M},async e=>{P("done")},async e=>{var t;P("edit"),Object.values(null!=(t=e.data)?t:{}).forEach(e=>{e&&(0,p.Q)(e,"error")})})},async e=>{(0,p.Q)("INTERNET_CONNECTION_PROBLEM","error")})}}])},[a,null==e?void 0:e.user_id,M,F,B]),W=(0,s.useCallback)(()=>{m&&F([{title:"AKCEPTUJ",action:()=>{if(H)P("preview");else{let e=N.$.validators.createGalleryRecord({asset_url:"",...M});e.asset_color_traits&&(0,p.Q)(e.asset_color_traits,"error"),e.asset_traits&&(0,p.Q)(e.asset_traits,"error")}},icon:_.H.Go}])},[m,H,M,F]);(0,s.useEffect)(()=>{W()},[W,M]);let $=(0,s.useCallback)(()=>{F([{title:"CROP",icon:_.H.Crop,action:async()=>{if(!Q.current){(0,d.O)("CROPPER","No cropperRef onCrop"),K();return}(0,h.sv)(),B(),await (0,b.aZ)(50),await (0,b.aZ)(50);let e=Q.current.getCanvas({maxWidth:u.t4});if(!e){(0,d.O)("CROPPER","No image available"),K();return}e.toBlob(e=>{if(!e){(0,d.O)("CROPPER","No blob"),K();return}let t=URL.createObjectURL(e);O(e),x(t),W()},u.V5,u.Y$),K()}}])},[W,K,F,B]),X=(0,s.useCallback)(()=>{U(!0),$()},[$]),{loadedImageSrc:Y,loadPhotoActionCallback:Z,onLoadImage:q,inputRef:ee,clearLoadedImage:et}=(e=>{let{onLoadAction:t}=e,a=(0,s.useRef)(null),i=(0,s.useCallback)(()=>{a.current&&a.current.click()},[]),r=f(),[n,l]=(0,s.useState)(),o=(0,s.useCallback)(()=>l(void 0),[]);return(0,s.useEffect)(()=>()=>{n&&URL.revokeObjectURL(n)},[n]),{loadedImageSrc:n,loadPhotoActionCallback:i,onLoadImage:e=>{(0,h.sv)(),r();let{files:a}=e.target;if(!a||!a[0])return;let i=a[0];if(!i.type.includes("image"))return void(0,p.Q)("Dozwolone są jedynie obrazy.","warning");if(i.size>1e7)return void(0,p.Q)("Maksymalny rozmiar to 10 MB.","warning");let s=new FileReader;s.onload=e=>{var a;l(null==(a=e.target)?void 0:a.result),t(),(0,h.UT)()},s.readAsDataURL(i),e.target.value=""},inputRef:a,clearLoadedImage:o}})({onLoadAction:X}),ea=(0,s.useCallback)(()=>{P("edit"),O(null),x(void 0),et(),U(!1),G(L.l),J()},[J,et]),ei=(0,s.useCallback)(()=>{F([{title:"KOLEJNE",icon:_.H.Restart,action:async()=>{ea()}},{title:"GALERIA",icon:_.H.Photos,action:async()=>{await t.push(E.JF.GALLERY)}}])},[ea,t,F]);return(0,s.useEffect)(()=>{"edit"===A&&W(),"preview"===A&&V(),"done"===A&&ei()},[W,ei,V,A]),(0,s.useEffect)(()=>{ea()},[ea]),(0,i.jsxs)(l.A,{sx:{marginLeft:o.M.containerGutter[0],marginRight:o.M.containerGutter[0]},children:[(0,i.jsx)("input",{ref:ee,type:"file",hidden:!0,accept:"image/*",onChange:q}),T?(0,i.jsx)(r.SFv,{canvas:!0,ref:Q,src:Y,style:{height:"calc(100dvh - calc(".concat(o.M.appBarDimension," * 2) - 50px)")},defaultSize:S,stencilSize:S,stencilProps:{aspectRatio:u.B$,handlers:!1,lines:!0,movable:!1,resizable:!1,grid:!0},imageRestriction:n.e.stencil}):(0,i.jsx)(j.j,{loadPhotoActionCallback:"edit"===A?Z:void 0,cropActionCallback:"edit"===A?X:void 0,editTraitsCallback:"edit"===A?()=>I(!0):void 0,shouldShowCardContent:!!m,el:{asset_url:m,asset_traits:M.asset_traits.length>0?M.asset_traits:[L.h],asset_color_traits:M.asset_color_traits.length>0?M.asset_color_traits:[L.h]}}),(0,i.jsx)(z,{selectedTraits:M,setSelectedTraits:G,isViewOpen:D,handleCloseView:()=>I(!1)})]})};var U=!0;function D(){return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(T,{})})}}},e=>{e.O(0,[160,95,260,820,603,634,230,636,593,792],()=>e(e.s=69969)),_N_E=e.O()}]);