try{!function(){var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},a=(new e.Error).stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="fe14e42e-f540-40aa-aecd-d7609c6f5fcc",e._sentryDebugIdIdentifier="sentry-dbid-fe14e42e-f540-40aa-aecd-d7609c6f5fcc")}()}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[265],{40593:(e,a,i)=>{"use strict";i.r(a),i.d(a,{__N_SSG:()=>U,default:()=>H});var r=i(37876),n=i(14232),t=i(8981),l=i(99735);i(52100);var s=i(90880),c=i.n(s),o=i(40359),d=i(82777),u=i(14259),p=i(5550),g=i(72506),f=i(42498),h=i(37383),b=i(56480),w=i(64221),_=i(89126);let j=5/4;var y=i(15184);let v=()=>{let e=(0,w.t)();return(0,n.useCallback)(()=>{e([{title:"W TOKU",action:()=>void 0,icon:y.H.Loading()}])},[e])};var m=i(47379),z=i(15102),x=i(48566),C=i(41040),A=i(2080),k=i(40503),R=i(45524),I=i(87662);let E=e=>"__id__".concat(e);var P=i(92089),D=i(64603),O=i(69542),N=i(30027);let L=[{label:"Dodawanie zdjęcia",description:(0,r.jsx)("span",{children:"Wybierz obraz z pamięci swojego urządzenia."})},{label:"Dostosowanie",description:(0,r.jsxs)("span",{children:["Cropper umożliwi Ci wybranie odpowiedniego rozmiaru. ",(0,r.jsx)("br",{}),"Gdy to zrobisz, przejdź dalej."]})},{label:"Wyb\xf3r cech",description:"W tym kroku wybierz cechy do zdjęcia.\n    Dzięki nim będziesz m\xf3gł tworzyć kategorie oraz filtrować swoją galerię."},{label:"Zapis zdjęcia do galerii",description:"Gotowe!"}],S=e=>{let{imageSize:a,visibleArea:i}=e;return{width:(null==i?void 0:i.width)||a.width,height:(null==i?void 0:i.height)||a.height}},T=()=>{let e=(0,R.GV)(I.mi),[a,i]=(0,n.useState)(null),[s,T]=(0,n.useState)(null),[U,H]=(0,n.useState)(0),[M,W]=(0,n.useState)(!0),[G,B]=(0,n.useState)(!1),J=(0,n.useRef)([]),Z=(0,n.useRef)([]),{galleryConfig:F}=(0,D.i)(),Q=(0,n.useRef)(null),K=(0,n.useCallback)(()=>{B(!1),W(!0)},[]),Y=v(),q=(0,w.t)(),X=(0,n.useCallback)(()=>{B(!0),q([{title:"CROP",action:async()=>{if(!Q.current)return void(0,_.O)("CROPPER","No cropperRef onCrop");(0,z.sv)(),Y(),await (0,x.aZ)(150),await (0,x.aZ)(150);let e=Q.current.getCanvas({maxWidth:1600});if(!e)return void(0,_.O)("CROPPER","No image available");e.toBlob(e=>{if(!e)return void(0,_.O)("CROPPER","No blob");let a=URL.createObjectURL(e);i(e),T(a)},"image/webp",.9),K(),(0,z.UT)()},icon:y.H.Crop()}]),W(!1)},[K,q,Y]),{loadedImageSrc:V,loadPhotoActionCallback:$,onLoadImage:ee,inputRef:ea,clearLoadedImage:ei}=(e=>{let{onLoadAction:a}=e,i=(0,n.useRef)(null),r=(0,n.useCallback)(()=>{i.current&&i.current.click()},[]),t=v(),[l,s]=(0,n.useState)(null),c=(0,n.useCallback)(()=>s(null),[]);return(0,n.useEffect)(()=>()=>{l&&URL.revokeObjectURL(l)},[l]),{loadedImageSrc:l,loadPhotoActionCallback:r,onLoadImage:e=>{(0,z.sv)(),t();let{files:i}=e.target;if(!i||!i[0])return;let r=i[0];if(!r.type.includes("image"))return void(0,m.Q)("Dozwolone są jedynie obrazy.","warning");if(r.size>1e7)return void(0,m.Q)("Maksymalny rozmiar to 10 MB.","warning");let n=new FileReader;n.onload=e=>{var i;s(null==(i=e.target)?void 0:i.result),a(),(0,z.UT)()},n.readAsDataURL(r),e.target.value=""},inputRef:i,clearLoadedImage:c}})({onLoadAction:X}),er=(0,n.useCallback)(()=>{H(3),q([])},[q]),en=(0,n.useRef)(null),et=(0,n.useCallback)(()=>{H(2),q([{title:"UPLOAD",action:async()=>{let i;if(!a||!(null==e?void 0:e.user_id))return void console.error("UploadAction early exit.");Y();let r=new FormData;r.append("file",a,E(e.user_id)),r.append("asset_folder",(i=e.user_id,(0,N.b8)()+"_"+E(i))),r.append("upload_preset",O.p),r.append("resource_type","image"),en.current?await (0,k.RQ)({asset_url:en.current.secure_url,traits:J.current,color_traits:Z.current},async e=>{en.current=null,er()},async e=>{et()}):await (0,k.dm)(r,async e=>{(0,m.Q)("Przetwarzanie zdjęcia, jeszcze chwila...","info"),en.current=e,await (0,k.RQ)({asset_url:e.secure_url,traits:J.current,color_traits:Z.current},async e=>{en.current=null,er()},async e=>{et()})},async e=>{et()})},icon:y.H.Upload()}])},[q,a,e,Y,er]);(0,n.useEffect)(()=>()=>{en.current&&(0,k.Bq)({asset_id:en.current.public_id},async e=>{},async e=>{})},[]);let el=(0,n.useCallback)(()=>{H(1),q([{title:"AKCEPTUJ",action:()=>{et()},icon:y.H.Accept()}])},[q,et]),es=(0,n.useCallback)(()=>{H(0),i(null),T(null),ei(),q([{title:"Wczytaj zdjęcie",action:$,icon:y.H.AddPhoto()}])},[ei,$,q]);return(0,n.useEffect)(()=>(es(),()=>{q([])}),[q,es]),(0,n.useEffect)(()=>{a&&el()},[a,el]),(0,r.jsxs)(o.A,{sx:{paddingBottom:b.M.spacing[5]},children:[(0,r.jsx)("input",{ref:ea,type:"file",hidden:!0,accept:"image/*",onChange:ee}),(0,r.jsx)(d.A,{variant:"h1",children:"Dodaj nowe zdjęcie do swojej galerii."}),V&&(0,r.jsxs)(o.A,{sx:{gap:b.M.spacing[1]},children:[!G&&(0,r.jsx)(o.A,{sx:{alignItems:"center"},children:(0,r.jsx)("img",{src:s||V,alt:"added-image",className:c().previewImage,style:{background:b.M.backgroundColor[1],marginTop:b.M.spacing[2],marginBottom:b.M.spacing[2]}})}),G&&(0,r.jsx)(t.SFv,{canvas:!0,ref:Q,src:V,className:c().previewImage,defaultSize:S,stencilSize:{width:320,height:250},stencilProps:{aspectRatio:j,handlers:!1,lines:!0,movable:!1,resizable:!1,grid:!0},imageRestriction:l.e.stencil})]}),1===U&&!G&&V?(0,r.jsx)(u.A,{onClick:$,variant:"outlined",endIcon:y.H.AddPhoto(),children:"WCZYTAJ INNE ZDJĘCIE"}):null,1===U&&!G&&a?(0,r.jsx)(u.A,{onClick:X,variant:"outlined",endIcon:y.H.Crop(),children:"CROP AGAIN"}):null,2===U?(0,r.jsx)(C.g,{galleryConfig:F,valuesRef:J,traitsType:"records_traits"}):null,2===U?(0,r.jsx)(C.g,{galleryConfig:F,valuesRef:Z,traitsType:"records_color_traits"}):null,2===U?(0,r.jsxs)(d.A,{children:["W ",(0,r.jsx)(A.A,{omitButtonElement:!0,children:"panelu zarządzania"})," możesz r\xf3wnież usuwać niepotrzebne cechy."]}):null,M?(0,r.jsx)(p.A,{activeStep:U,orientation:"vertical",sx:{margin:b.M.spacing[4]},children:L.map((e,a)=>(0,r.jsxs)(g.A,{children:[(0,r.jsx)(f.A,{children:(0,r.jsx)(d.A,{variant:"h3",children:e.label})}),(0,r.jsx)(h.A,{children:(0,r.jsx)(d.A,{variant:"body1",children:e.description})})]},e.label))}):null,2===U?(0,r.jsx)(u.A,{sx:{padding:b.M.spacing[4]},onClick:el,variant:"text",startIcon:y.H.Back(),children:"Wr\xf3ć do wyboru zdjęcia"}):null,3===U?(0,r.jsxs)(o.A,{gap:b.M.spacing[4],children:[(0,r.jsx)(u.A,{onClick:es,variant:"contained",endIcon:y.H.AddPhoto(),children:"DODAJ KOLEJNE ZDJĘCIE"}),(0,r.jsx)(A.A,{route:P.JF.GALLERY,children:"IDŹ DO GALERII"})]}):null]})};var U=!0;function H(){return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(T,{})})}},69969:(e,a,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/gallery/upload-asset",function(){return i(40593)}])},90880:e=>{e.exports={previewImage:"cropper_previewImage__E9nPl",croppedImage:"cropper_croppedImage__YHdq5",preview:"cropper_preview__iGsPN"}}},e=>{e.O(0,[160,95,820,641,486,305,55,448,636,593,792],()=>e(e.s=69969)),_N_E=e.O()}]);